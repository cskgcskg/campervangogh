<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking | Camper Van Gogh</title>

    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://formspree.io https://js.stripe.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' https://res.cloudinary.com data:; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self' https://formspree.io https://api.stripe.com; frame-src https://js.stripe.com https://checkout.stripe.com;">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://js.stripe.com">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts with display=swap for faster rendering -->
    <link
        href="https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@300;400;500;600&family=Caveat:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Flatpickr for visual calendar with blocked dates -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Stripe.js for payment processing -->
    <script src="https://js.stripe.com/v3/"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'paper': '#F2F0E9',
                        'ink': '#121212',
                        'pop': '#FF5733',
                        'canvas': '#E6E2D6',
                    },
                    fontFamily: {
                        'headline': ['"Anton"', 'sans-serif'],
                        'body': ['"Inter"', 'sans-serif'],
                        'hand': ['"Caveat"', 'cursive'],
                    },
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F2F0E9;
            color: #121212;
            cursor: crosshair;
        }

        .brutal-border {
            border: 2px solid #121212;
        }

        .hard-shadow {
            box-shadow: 6px 6px 0px 0px #121212;
        }

        /* Custom Date Picker Styling */
        input[type="date"] {
            appearance: none;
            -webkit-appearance: none;
        }

        /* Flatpickr Calendar Customization */
        .flatpickr-calendar {
            border: 2px solid #121212 !important;
            box-shadow: 6px 6px 0px 0px #121212 !important;
            font-family: 'Inter', sans-serif !important;
        }

        .flatpickr-day.disabled,
        .flatpickr-day.disabled:hover,
        .flatpickr-day.flatpickr-disabled,
        .flatpickr-day.flatpickr-disabled:hover {
            background-color: #ffcccc !important;
            color: #cc0000 !important;
            text-decoration: line-through !important;
            cursor: not-allowed !important;
        }

        .flatpickr-day.today {
            border: 2px solid #FF5733 !important;
        }

        .flatpickr-day.selected {
            background-color: #FF5733 !important;
            border-color: #FF5733 !important;
        }

        /* Available Dates Styling */
        .flatpickr-day:not(.disabled):not(.flatpickr-disabled):not(.prevMonthDay):not(.nextMonthDay) {
            background-color: #e6f4ea !important;
            color: #1e8e3e !important;
        }

        .flatpickr-day:hover:not(.disabled):not(.flatpickr-disabled) {
            background-color: #d1ead6 !important;
        }
    </style>
</head>

<body class="font-body pb-32">

    <!-- Top Bar -->
    <header
        class="fixed top-0 w-full z-40 px-6 py-4 flex justify-between items-center mix-blend-difference text-white pointer-events-none">
        <div class="font-headline uppercase tracking-widest text-xl pointer-events-auto">
            <a href="index.html">Camper Van Gogh<span class="text-pop">.</span></a>
        </div>
        <div class="font-mono text-xs hidden md:block opacity-60">
            SECURE_BOOKING_CHANNEL_V1
        </div>
    </header>

    <main class="w-full relative pt-24 px-4 md:px-12 max-w-7xl mx-auto">

        <form action="https://formspree.io/f/mkojwddd" method="POST" id="booking-form">

            <!-- Header -->
            <div class="mb-12 border-b-2 border-ink pb-8">
                <span class="font-mono text-xs bg-ink text-white px-2 py-1">STEP 1: CONFIGURATION</span>
                <h1 class="font-headline text-6xl md:text-8xl mt-4 uppercase leading-none">Reserve<br>the Art</h1>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 relative">

                <!-- LEFT COLUMN: The Form -->
                <div class="lg:col-span-2 space-y-12">

                    <!-- Dates Section -->
                    <section>
                        <h2 class="font-headline text-3xl mb-6 flex items-center gap-3"><span
                                class="bg-pop text-white w-8 h-8 flex items-center justify-center text-lg rounded-full">1</span>
                            Dates</h2>
                        <div
                            class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6 bg-white border-2 border-ink hard-shadow transform -rotate-1">
                            <div>
                                <label class="block font-mono text-xs font-bold mb-2 uppercase">Pick Up</label>
                                <input type="text" id="start-date" name="Pick Up Date" required
                                    placeholder="Select date..."
                                    class="w-full bg-white border-2 border-ink p-3 font-mono focus:outline-none focus:bg-pop/10 focus:border-pop transition cursor-pointer">
                            </div>
                            <div>
                                <label class="block font-mono text-xs font-bold mb-2 uppercase">Drop Off</label>
                                <input type="text" id="end-date" name="Drop Off Date" required
                                    placeholder="Select date..."
                                    class="w-full bg-white border-2 border-ink p-3 font-mono focus:outline-none focus:bg-pop/10 focus:border-pop transition cursor-pointer">
                            </div>
                            <div class="col-span-1 md:col-span-2 flex flex-wrap items-center gap-4 mt-2">
                                <div class="flex items-center gap-2 font-mono text-[10px] uppercase">
                                    <span class="w-3 h-3 bg-[#e6f4ea] border border-[#1e8e3e]"></span> Available
                                </div>
                                <div class="flex items-center gap-2 font-mono text-[10px] uppercase">
                                    <span class="w-3 h-3 bg-[#ffcccc] border border-[#cc0000] relative overflow-hidden">
                                        <span
                                            class="absolute top-1/2 left-0 w-full h-[1px] bg-[#cc0000] -rotate-45"></span>
                                    </span> Booked
                                </div>
                                <div class="flex items-center gap-2 font-mono text-[10px] uppercase ml-auto">
                                    <span class="text-gray-400 italic" id="date-message">* Min 3 days. Hampshire,
                                        UK.</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Guests Section -->
                    <section>
                        <h2 class="font-headline text-3xl mb-6 flex items-center gap-3"><span
                                class="bg-pop text-white w-8 h-8 flex items-center justify-center text-lg rounded-full">2</span>
                            Passengers</h2>
                        <div class="flex flex-wrap gap-4">
                            <div
                                class="flex-1 min-w-[150px] p-6 bg-white border-2 border-ink shadow-[4px_4px_0px_0px_#121212]">
                                <label class="block font-mono text-xs font-bold mb-4 uppercase">Adults</label>
                                <div class="flex items-center justify-between border-2 border-ink p-2">
                                    <button type="button" id="adults-minus"
                                        class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 font-bold transition"
                                        onclick="adjustCount('adults', -1)">-</button>
                                    <span id="adults-count" class="font-headline text-3xl">4</span>
                                    <input type="hidden" id="adults-input" name="Adults" value="4">
                                    <button type="button" id="adults-plus"
                                        class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 font-bold transition"
                                        onclick="adjustCount('adults', 1)">+</button>
                                </div>
                            </div>
                            <div
                                class="flex-1 min-w-[150px] p-6 bg-white border-2 border-ink shadow-[4px_4px_0px_0px_#121212]">
                                <label class="block font-mono text-xs font-bold mb-4 uppercase">Children</label>
                                <div class="flex items-center justify-between border-2 border-ink p-2">
                                    <button type="button" id="children-minus"
                                        class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 font-bold transition"
                                        onclick="adjustCount('children', -1)">-</button>
                                    <span id="children-count" class="font-headline text-3xl">0</span>
                                    <input type="hidden" id="children-input" name="Children" value="0">
                                    <button type="button" id="children-plus"
                                        class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 font-bold transition"
                                        onclick="adjustCount('children', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-[10px] font-mono text-gray-500 uppercase">
                            * Maximum capacity: 4 passengers total (at least 1 adult).
                        </div>
                    </section>

                    <!-- Extras Section -->
                    <section>
                        <h2 class="font-headline text-3xl mb-6 flex items-center gap-3"><span
                                class="bg-pop text-white w-8 h-8 flex items-center justify-center text-lg rounded-full">3</span>
                            Extras</h2>
                        <div class="space-y-4">

                            <!-- Extra Item -->
                            <label class="block relative cursor-pointer group">
                                <input type="checkbox" class="peer sr-only" id="extra-pet" name="Extras" value="Pet Fee"
                                    onchange="calculateTotal()">
                                <div
                                    class="bg-white p-4 border-2 border-ink flex items-center justify-between peer-checked:bg-ink peer-checked:text-white transition">
                                    <div class="flex items-center gap-4">
                                        <i class="fa-solid fa-dog text-2xl"></i>
                                        <div>
                                            <div class="font-bold uppercase">Pet Cleansing Fee</div>
                                            <div class="text-xs font-mono opacity-70">Deep clean for furry friends</div>
                                        </div>
                                    </div>
                                    <div class="font-mono font-bold">+£25</div>
                                </div>
                                <div
                                    class="absolute inset-0 border-2 border-ink translate-x-1 translate-y-1 -z-10 bg-gray-200 group-hover:translate-x-2 group-hover:translate-y-2 transition">
                                </div>
                            </label>

                            <!-- Extra Item -->
                            <label class="block relative cursor-pointer group">
                                <input type="checkbox" class="peer sr-only" id="extra-bike" name="Extras"
                                    value="Bike Rack" onchange="calculateTotal()">
                                <div
                                    class="bg-white p-4 border-2 border-ink flex items-center justify-between peer-checked:bg-ink peer-checked:text-white transition">
                                    <div class="flex items-center gap-4">
                                        <i class="fa-solid fa-bicycle text-2xl"></i>
                                        <div>
                                            <div class="font-bold uppercase">Bike Rack</div>
                                            <div class="text-xs font-mono opacity-70">Holds 4 bikes securely</div>
                                        </div>
                                    </div>
                                    <div class="font-mono font-bold">+£20</div>
                                </div>
                                <div
                                    class="absolute inset-0 border-2 border-ink translate-x-1 translate-y-1 -z-10 bg-gray-200 group-hover:translate-x-2 group-hover:translate-y-2 transition">
                                </div>
                            </label>

                            <!-- Extra Item -->
                            <label class="block relative cursor-pointer group">
                                <input type="checkbox" class="peer sr-only" id="extra-late" name="Extras"
                                    value="Late Checkout" onchange="calculateTotal()">
                                <div
                                    class="bg-white p-4 border-2 border-ink flex items-center justify-between peer-checked:bg-ink peer-checked:text-white transition">
                                    <div class="flex items-center gap-4">
                                        <i class="fa-solid fa-clock text-2xl"></i>
                                        <div>
                                            <div class="font-bold uppercase">Late Checkout</div>
                                            <div class="text-xs font-mono opacity-70">Drop off at 6pm instead of 11am
                                            </div>
                                        </div>
                                    </div>
                                    <div class="font-mono font-bold">+£40</div>
                                </div>
                                <div
                                    class="absolute inset-0 border-2 border-ink translate-x-1 translate-y-1 -z-10 bg-gray-200 group-hover:translate-x-2 group-hover:translate-y-2 transition">
                                </div>
                            </label>

                        </div>
                    </section>

                    <!-- Personal Info -->
                    <section>
                        <h2 class="font-headline text-3xl mb-6 flex items-center gap-3"><span
                                class="bg-pop text-white w-8 h-8 flex items-center justify-center text-lg rounded-full">4</span>
                            Details</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <input type="text" id="user-name" name="Name" required placeholder="FULL NAME"
                                class="w-full bg-transparent border-b-2 border-black py-4 font-mono focus:border-pop focus:outline-none">
                            <input type="email" id="user-email" name="Email" required placeholder="EMAIL ADDRESS"
                                class="w-full bg-transparent border-b-2 border-black py-4 font-mono focus:border-pop focus:outline-none">
                            <textarea id="user-msg" name="Message"
                                class="w-full md:col-span-2 bg-transparent border-b-2 border-black py-4 font-mono focus:border-pop focus:outline-none"
                                rows="2" placeholder="ANY REQUESTS?"></textarea>
                        </div>

                        <!-- Honeypot for spam protection -->
                        <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off">
                    </section>

                    <!-- Hidden inputs for calculated values -->
                    <input type="hidden" id="total-days-input" name="Total Days">
                    <input type="hidden" id="grand-total-input" name="Estimated Cost">

                </div>

                <!-- RIGHT COLUMN: The Receipt (Sticky) -->
                <div class="lg:col-span-1">
                    <div class="sticky top-24">
                        <div class="bg-white border-2 border-ink p-8 relative">
                            <!-- Tape -->
                            <div
                                class="absolute -top-4 left-1/2 -translate-x-1/2 w-24 h-6 bg-red-500/20 rotate-3 transform">
                            </div>

                            <h3 class="font-headline text-4xl uppercase mb-6 text-center">Receipt</h3>

                            <div class="space-y-4 font-mono text-sm border-t border-b border-gray-200 py-6 mb-6">
                                <div class="flex justify-between">
                                    <span class="opacity-60">Rate</span>
                                    <span>£92 x <span id="days-count">0</span> nights</span>
                                </div>
                                <div class="flex justify-between" id="receipt-extras" style="display:none">
                                    <span class="opacity-60">Extras</span>
                                    <span>+£<span id="extras-total">0</span></span>
                                </div>
                                <div class="flex justify-between font-bold">
                                    <span>Rental Cost</span>
                                    <span>£<span id="rental-total">0</span></span>
                                </div>
                                <div class="border-t border-gray-300 pt-4 mt-4">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="font-bold">Security Deposit</div>
                                            <div class="text-[10px] opacity-60 mt-1">Held in escrow, returned after
                                                rental</div>
                                        </div>
                                        <span class="font-bold">£750</span>
                                    </div>
                                </div>
                                <div
                                    class="flex justify-between font-bold text-2xl text-pop border-t border-gray-300 pt-4">
                                    <span>Total Due</span>
                                    <span>£<span id="grand-total">0</span></span>
                                </div>
                            </div>

                            <div id="error-box"
                                class="hidden bg-red-100 text-red-600 text-xs font-bold p-3 mb-4 border border-red-300">
                                Please select valid dates (min 3 days).
                            </div>

                            <!-- Single Request Button -->
                            <div class="space-y-3">
                                <button type="button" onclick="validateAndSubmit()"
                                    class="w-full bg-ink text-white py-4 font-headline uppercase text-2xl hover:bg-pop transition shadow-lg transform hover:-translate-y-1">
                                    <i class="fa-solid fa-paper-plane mr-2"></i>Request to Book
                                </button>
                                <p class="text-[11px] leading-tight text-gray-500 font-mono text-center px-2">
                                    No payment is taken at this stage. We will review your request and send a
                                    verification link. Once approved, you can finalize your payment to secure the dates.
                                </p>
                            </div>

                            <!-- How it Works section -->
                            <div class="mt-8 pt-6 border-t border-dashed border-gray-300">
                                <h4 class="font-mono text-[10px] font-bold uppercase tracking-widest mb-4 opacity-50">
                                    How it Works</h4>
                                <div class="space-y-4">
                                    <div class="flex gap-3">
                                        <div class="font-headline text-lg text-pop">01.</div>
                                        <div class="text-[10px] font-mono leading-tight uppercase">Submit Booking
                                            Request</div>
                                    </div>
                                    <div class="flex gap-3">
                                        <div class="font-headline text-lg text-pop">02.</div>
                                        <div class="text-[10px] font-mono leading-tight uppercase">Driver License, Two Proofs of Address & DVLA check
                                            </div>
                                    </div>
                                    <div class="flex gap-3">
                                        <div class="font-headline text-lg text-pop">03.</div>
                                        <div class="text-[10px] font-mono leading-tight uppercase">Secure Payment
                                            (Post-Approval)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </form>

    </main>

    <!-- Dock for Mobile Nav Consistency -->
    <nav
        class="fixed bottom-0 left-0 w-full z-40 px-4 pb-4 pt-4 bg-gradient-to-t from-paper via-paper to-transparent md:hidden">
        <div
            class="max-w-4xl mx-auto bg-ink text-white rounded-full px-2 py-2 flex justify-between items-center shadow-2xl border border-gray-800">
            <a href="index.html"
                class="px-5 py-3 rounded-full hover:bg-white/10 transition text-sm font-bold uppercase tracking-wider flex items-center gap-2">
                <i class="fa-solid fa-arrow-left text-pop"></i> <span>Back</span>
            </a>
            <div class="px-5 py-3 font-headline text-xl">Booking</div>
        </div>
    </nav>

    <script>
        const DAILY_RATE = 92;
        const SECURITY_DEPOSIT = 750; // Fixed £750 escrow deposit
        let guestCounts = { adults: 4, children: 0 };

        // Add this code right after line 353 in booking.html

        // ==================== CALENDAR BLOCKING SYSTEM ====================
        let blockedDates = [];

        async function loadBlockedDates() {
            try {
                const response = await fetch('blocked-dates.json');
                const data = await response.json();
                blockedDates = data.blockedDates || [];
                // Initialize pickers immediately after data is loaded
                initializeDatePickers();
            } catch (error) {
                console.error("Error loading blocked dates:", error);
                blockedDates = [];
                initializeDatePickers(); // Initialize anyway
            }
        }

        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function isDateBlocked(dateString) {
            return blockedDates.includes(dateString);
        }

        function isRangeBlocked(startDate, endDate) {
            if (!startDate || !endDate) return { blocked: false };

            const start = new Date(startDate);
            const end = new Date(endDate);

            for (let dt = new Date(start); dt <= end; dt.setDate(dt.getDate() + 1)) {
                const dateStr = formatDate(dt);
                if (isDateBlocked(dateStr)) {
                    return { blocked: true, date: dateStr };
                }
            }
            return { blocked: false };
        }

        loadBlockedDates(); // Load blocked dates on page load

        // Initialize Flatpickr date pickers with visual blocking
        function initializeDatePickers() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Start date picker
            const startPicker = flatpickr("#start-date", {
                minDate: today,
                dateFormat: "Y-m-d",
                disable: blockedDates,
                onChange: function (selectedDates, dateStr) {
                    if (selectedDates.length > 0) {
                        const minEndDate = new Date(selectedDates[0]);
                        minEndDate.setDate(minEndDate.getDate() + 3); // Minimum 3 days
                        endPicker.set('minDate', minEndDate);
                    }
                    calculateTotal();
                },
                onDayCreate: function (dObj, dStr, fp, dayElem) {
                    const dateStr = formatDate(dayElem.dateObj);
                    if (isDateBlocked(dateStr)) {
                        dayElem.classList.add('disabled');
                        dayElem.innerHTML += '<br><small style="font-size:8px; line-height:1; display:block; margin-top:2px; opacity:0.8;">Booked</small>';
                    }
                }
            });

            // End date picker
            const endPicker = flatpickr("#end-date", {
                minDate: new Date(today.getTime() + (3 * 24 * 60 * 60 * 1000)),
                dateFormat: "Y-m-d",
                disable: blockedDates,
                onChange: function () {
                    calculateTotal();
                },
                onDayCreate: function (dObj, dStr, fp, dayElem) {
                    const dateStr = formatDate(dayElem.dateObj);
                    if (isDateBlocked(dateStr)) {
                        dayElem.classList.add('disabled');
                        dayElem.innerHTML += '<br><small style="font-size:8px; line-height:1; display:block; margin-top:2px; opacity:0.8;">Booked</small>';
                    }
                }
            });
        }

        // Initial call to load data
        loadBlockedDates();
        // ==================================================================

        function adjustCount(type, delta) {
            const current = guestCounts[type];
            const otherType = type === 'adults' ? 'children' : 'adults';
            const total = guestCounts.adults + guestCounts.children;

            // Rule 1: Minimum 0 children
            if (type === 'children' && current + delta < 0) return;

            // Rule 2: Minimum 1 adult
            if (type === 'adults' && current + delta < 1) return;

            // Rule 3: Maximum 4 total guests
            if (delta > 0 && total + delta > 4) return;

            // Apply change
            guestCounts[type] = current + delta;

            // Update UI
            document.getElementById(`${type}-count`).innerText = guestCounts[type];
            document.getElementById(`${type}-input`).value = guestCounts[type];

            // Re-calculate receipt
            calculateTotal();
            updateButtonStates();
        }

        function updateButtonStates() {
            const total = guestCounts.adults + guestCounts.children;

            // Plus buttons
            document.getElementById('adults-plus').disabled = (total >= 4);
            document.getElementById('children-plus').disabled = (total >= 4);

            // Minus buttons
            document.getElementById('adults-minus').disabled = (guestCounts.adults <= 1);
            document.getElementById('children-minus').disabled = (guestCounts.children <= 0);

            // Style disabled states
            const buttons = ['adults-plus', 'children-plus', 'adults-minus', 'children-minus'];
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn && btn.disabled) {
                    btn.classList.add('opacity-30', 'cursor-not-allowed');
                } else if (btn) {
                    btn.classList.remove('opacity-30', 'cursor-not-allowed');
                }
            });
        }

        // Initialize button states
        setTimeout(updateButtonStates, 100);

        function calculateTotal() {
            const startInput = document.getElementById('start-date').value;
            const endInput = document.getElementById('end-date').value;
            const dateMessage = document.getElementById('date-message');
            const errorBox = document.getElementById('error-box');

            let days = 0;
            let extrasCost = 0;

            // Date Calc
            if (startInput && endInput) {
                const start = new Date(startInput);
                const end = new Date(endInput);
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (start < end) {
                    days = diffDays;
                    dateMessage.innerText = `${days} nights selected.`;
                    dateMessage.classList.remove('text-red-500');
                    dateMessage.classList.add('text-gray-500');
                } else {
                    dateMessage.innerText = "Check-out must be after Check-in.";
                    dateMessage.classList.add('text-red-500');
                }
            }

            // Extras Calc
            if (document.getElementById('extra-pet').checked) extrasCost += 25;
            if (document.getElementById('extra-bike').checked) extrasCost += 20;
            if (document.getElementById('extra-late').checked) extrasCost += 40;

            // Calculate rental cost (without deposit)
            const rentalCost = (days * DAILY_RATE) + extrasCost;
            // Calculate grand total (rental + deposit)
            const grandTotal = rentalCost + SECURITY_DEPOSIT;

            // DOM Updates
            document.getElementById('days-count').innerText = days;
            document.getElementById('extras-total').innerText = extrasCost;
            document.getElementById('rental-total').innerText = rentalCost; // Rental subtotal
            document.getElementById('grand-total').innerText = grandTotal; // Total with deposit

            // Update hidden inputs for form submission
            document.getElementById('total-days-input').value = days;
            document.getElementById('grand-total-input').value = "£" + grandTotal;

            if (extrasCost > 0) {
                document.getElementById('receipt-extras').style.display = 'flex';
            } else {
                document.getElementById('receipt-extras').style.display = 'none';
            }

            return { days, extrasCost, rentalCost, grandTotal, deposit: SECURITY_DEPOSIT };
        }

        // Attach listeners
        document.getElementById('start-date').addEventListener('change', calculateTotal);
        document.getElementById('end-date').addEventListener('change', calculateTotal);

        // Replace the validateAndSubmit function (around line 425) with this updated version:

        function validateAndSubmit() {
            const { days } = calculateTotal();
            const form = document.getElementById('booking-form');
            const errorBox = document.getElementById('error-box');
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            // Check minimum days
            if (days < 3) {
                errorBox.innerText = "Minimum rental period is 3 days.";
                errorBox.classList.remove('hidden');
                return;
            }

            // Check if dates overlap with blocked dates
            const rangeCheck = isRangeBlocked(startDate, endDate);
            if (rangeCheck.blocked) {
                errorBox.innerText = `Sorry, ${rangeCheck.date} is already booked. Please select different dates.`;
                errorBox.classList.remove('hidden');
                return;
            }

            // Check form validity
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            errorBox.classList.add('hidden');
            form.submit(); // Send inquiry email via Formspree
        }



        // ==================== STRIPE PAYMENT INTEGRATION ====================
        // 
        // SETUP INSTRUCTIONS:
        // 1. Create account at https://stripe.com (FREE)
        // 2. Get your Publishable Key from Dashboard > Developers > API Keys
        // 3. Replace 'YOUR_PUBLISHABLE_KEY_HERE' below with your actual key
        // 4. Create a Product in Stripe Dashboard:
        //    - Name: "Campervan Rental - Daily Rate"
        //    - Price: £92 (or use dynamic pricing - see Option 2 below)
        // 5. Test with test mode first, then switch to live mode
        //
        // OPTION 1: Simple Payment Link (Easiest - No Code Changes Needed)
        // - Create a Payment Link in Stripe Dashboard
        // - Replace the validateAndProceedToPayment function to just redirect:
        //   window.location.href = 'https://buy.stripe.com/YOUR_LINK';
        //
        // OPTION 2: Dynamic Stripe Checkout (Recommended - shown below)
        // - Uses Stripe.js to create dynamic checkout sessions
        // - Allows custom pricing based on dates/extras
        // =====================================================================

        // Initialize Stripe (replace with your actual publishable key)
        const stripe = Stripe('pk_test_YOUR_PUBLISHABLE_KEY_HERE');
        // For live mode, use: pk_live_YOUR_PUBLISHABLE_KEY_HERE

        async function validateAndProceedToPayment() {
            const { days, rentalCost, grandTotal, deposit, extrasCost } = calculateTotal();
            const form = document.getElementById('booking-form');
            const errorBox = document.getElementById('error-box');

            // Validate form
            if (days < 3) {
                errorBox.innerText = "Minimum rental period is 3 days.";
                errorBox.classList.remove('hidden');
                return;
            }

            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            errorBox.classList.add('hidden');

            // Get calculated values (already retrieved above)
            const totalCost = grandTotal; // Includes rental + £750 deposit
            const totalInPence = Math.round(totalCost * 100); // Stripe uses smallest currency unit

            // Get booking details
            const bookingData = {
                startDate: document.getElementById('start-date').value,
                endDate: document.getElementById('end-date').value,
                adults: guestCounts.adults,
                children: guestCounts.children,
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                message: document.getElementById('user-msg').value,
                days: days,
                extrasCost: extrasCost,
                totalCost: totalCost
            };

            // SIMPLE METHOD: Redirect to Stripe Payment Link
            // Uncomment this and add your payment link:
            // window.location.href = 'https://buy.stripe.com/YOUR_PAYMENT_LINK?prefilled_email=' + bookingData.email;
            // return;

            // ADVANCED METHOD: Use Stripe Checkout API
            // This requires a backend endpoint to create checkout sessions
            // For now, show a helpful message:
            errorBox.classList.remove('hidden');
            errorBox.classList.remove('bg-red-100', 'text-red-600', 'border-red-300');
            errorBox.classList.add('bg-blue-100', 'text-blue-800', 'border-blue-300');
            errorBox.innerHTML = `
                <strong>Stripe Setup Required:</strong><br>
                To enable live payments:<br>
                1. Create Stripe account at <a href="https://stripe.com" target="_blank" class="underline">stripe.com</a><br>
                2. Create a Payment Link in your dashboard<br>
                3. Update the code with your payment link<br>
                <br>
                <strong>Booking Breakdown:</strong><br>
                Rental Cost: £${rentalCost}<br>
                Security Deposit: £${deposit} (held in escrow)<br>
                <strong>Total Payment: £${totalCost}</strong><br>
                <br>
                For now, use the "Inquiry Only" button below.
            `;

            // When ready, use this code with your backend:
            /*
            try {
                const response = await fetch('YOUR_BACKEND_URL/create-checkout-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bookingData)
                });
                const session = await response.json();
                
                // Redirect to Stripe Checkout
                const result = await stripe.redirectToCheckout({
                    sessionId: session.id
                });
                
                if (result.error) {
                    errorBox.innerText = result.error.message;
                    errorBox.classList.remove('hidden');
                }
            } catch (error) {
                errorBox.innerText = "Payment system error. Please try inquiry option.";
                errorBox.classList.remove('hidden');
            }
            */
        }
    </script>
</body>

</html>
```